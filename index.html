<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 虛擬剪輯工具</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 設定 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* 響應式影片容器樣式 (16:9 比例) */
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.5rem; /* rounded-xl */
        }
        /* 確保內層播放器填滿容器 */
        #player, #share-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* 修正手機尺寸溢出問題：強制隱藏水平滾動條 */
        body {
            overflow-x: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans p-4 sm:p-8">

    <div id="app-container" class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl space-y-8">
        <h1 class="text-3xl font-bold text-gray-800 border-b pb-3 mb-6">YouTube 精華片段播放清單</h1>

        <!-- 訊息/警告區 -->
        <div id="message-box" class="hidden p-4 rounded-lg text-sm transition-all duration-300"></div>

        <!-- 編輯介面 (預設顯示) -->
        <div id="editor-view" class="space-y-6">
            <!-- YouTube 網址輸入區 -->
            <div class="space-y-4 p-4 border border-blue-200 bg-blue-50 rounded-lg">
                <label for="youtube-url" class="block text-lg font-semibold text-gray-700">步驟 1: 輸入 YouTube 影片網址</label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="url" id="youtube-url" placeholder="例如：https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                           class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                           value="">
                    <button id="load-video-btn" onclick="loadVideoFromInput()"
                            class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition duration-150">
                        載入影片
                    </button>
                </div>
            </div>

            <!-- 編輯區 (載入影片後顯示) -->
            <div id="edit-area" class="hidden space-y-6">
                <h2 class="text-2xl font-semibold text-gray-800">步驟 2: 剪輯片段編輯</h2>

                <div id="player-status" class="text-center text-gray-600 font-medium mb-4">
                    當前播放時間: <span id="current-time" class="text-blue-600">00:00</span>
                </div>

                <!-- YouTube 播放器 (已加入 .video-wrapper) -->
                <div id="player-container" class="video-wrapper">
                    <div id="player"></div>
                </div>

                <!-- 片段列表 -->
                <div id="segments-list" class="space-y-4 p-4 border border-gray-200 rounded-lg bg-white shadow-inner">
                    <!-- Segment input will be injected here -->
                </div>

                <!-- 新增片段按鈕 -->
                <button onclick="addSegment()"
                        class="w-full px-4 py-3 border border-blue-500 text-blue-600 font-medium rounded-lg hover:bg-blue-50 transition duration-150 flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    <span>新增時間點輸入區</span>
                </button>

                <!-- 預覽完整剪接影片按鈕 -->
                <div class="pt-4 border-t mt-6">
                    <button id="play-full-spliced-btn" onclick="playFullSplicedVideo()" disabled
                            class="w-full px-6 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg hover:bg-green-600 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed">
                        預覽完整剪接影片 (0 片段)
                    </button>
                </div>
            </div>
        </div>

        <!-- 分享介面 (網址有參數時顯示) -->
        <div id="share-view" class="hidden space-y-6">
            <h2 class="text-2xl font-semibold text-gray-800 text-center">分享的精華片段播放清單</h2>
            <p id="share-info" class="text-center text-gray-600"></p>

            <!-- YouTube 播放器 for share view (已加入 .video-wrapper) -->
            <div id="share-player-container" class="w-full max-w-2xl mx-auto video-wrapper">
                <div id="share-player"></div>
            </div>

            <div class="text-center pt-4">
                <button onclick="window.location.href = window.location.origin + window.location.pathname"
                        class="px-6 py-3 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition duration-150">
                    返回編輯模式
                </button>
            </div>
        </div>

        <!-- 分享連結區 (編輯模式下顯示) -->
        <div id="share-link-area" class="hidden pt-6 border-t mt-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-3">分享連結</h3>
            <div class="flex flex-col sm:flex-row gap-2">
                <input type="text" id="share-link" readonly
                       class="flex-grow p-3 border border-gray-300 bg-gray-100 rounded-lg text-sm overflow-hidden whitespace-nowrap text-ellipsis">
                <button onclick="copyShareLink()"
                        class="w-full sm:w-auto px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
                    複製連結
                </button>
            </div>
        </div>
    </div>

    <!-- 載入 YouTube Player API -->
    <script>
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

    <script>
        // --- 全域變數 ---
        let player; // for editor view
        let sharePlayer; // for share view
        let videoId = '';
        let segments = []; // [{ start: number, end: number, startInput: string, endInput: string }, ...]
        let isPlayingSequence = false;
        let currentSegmentIndex = 0;
        let intervalId = null; // 編輯模式的計時器
        let shareIntervalId = null; // 分享模式的計時器
        let isShareMode = false;

        // --- 輔助函數：時間格式轉換 (MM:SS <-> Seconds) ---

        /** 將秒數轉換為 MM:SS 格式 */
        function secondsToTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = Math.floor(totalSeconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        /** 將 MM:SS 格式字串轉換為秒數 (支援 SS 或 MM:SS) */
        function timeToSeconds(timeStr) {
            if (!timeStr) return 0;
            const parts = timeStr.split(':').map(p => parseInt(p.trim()) || 0);
            if (parts.length === 1) {
                return parts[0]; // 只提供秒數
            } else if (parts.length === 2) {
                return parts[0] * 60 + parts[1]; // MM:SS
            }
            return 0;
        }

        /** 顯示訊息框 */
        function displayMessage(message, type = 'info') {
            const box = document.getElementById('message-box');
            box.innerText = message;
            box.className = 'p-4 rounded-lg text-sm transition-all duration-300'; // Reset classes
            box.classList.remove('hidden');

            switch (type) {
                case 'success':
                    box.classList.add('bg-green-100', 'text-green-800');
                    break;
                case 'error':
                    box.classList.add('bg-red-100', 'text-red-800');
                    break;
                case 'warning':
                    box.classList.add('bg-yellow-100', 'text-yellow-800');
                    break;
                case 'info':
                default:
                    box.classList.add('bg-blue-100', 'text-blue-800');
                    break;
            }
            // 讓訊息持續顯示 5 秒
            setTimeout(() => {
                 box.classList.add('hidden');
            }, 5000);
        }

        // --- 步驟 1: 載入影片 ---

        /** 從網址輸入框載入影片 */
        function loadVideoFromInput() {
            const urlInput = document.getElementById('youtube-url').value;
            const id = extractVideoId(urlInput);

            if (!id) {
                displayMessage('請輸入有效的 YouTube 影片網址或 ID。', 'error');
                return;
            }

            videoId = id;
            document.getElementById('edit-area').classList.remove('hidden');
            document.getElementById('load-video-btn').disabled = true;

            // 如果播放器尚未初始化，則初始化
            if (!player) {
                initYouTubePlayer('player', videoId, true);
            } else {
                // 如果已經存在，則直接載入新影片
                player.loadVideoById(videoId);
            }

            // 確保至少有一個片段輸入區
            if (segments.length === 0) {
                addSegment();
            }

            // 更新分享連結
            updateShareLink();
        }

        /** 從 URL 提取 YouTube 影片 ID */
        function extractVideoId(url) {
            if (!url) return null;
            let id = null;
            url = url.replace(/(>|<)/gi, '').split(/(\/embed\/|v=|\/v\/|\/youtu\.be\/|\/shorts\/|\/live\/)/);
            if (url[2]) {
                id = url[2].split(/[^0-9a-z_-]/i);
                id = id[0];
            } else {
                id = url.join('').match(/[a-zA-Z0-9_-]{11}/);
                id = id ? id[0] : null;
            }
            return id;
        }


        // --- YouTube API 播放器控制 ---

        /** 初始化 YouTube Player */
        function initYouTubePlayer(elementId, id, isEditor) {
            return new YT.Player(elementId, {
                videoId: id,
                playerVars: {
                    'controls': 1,
                    'modestbranding': 1,
                    'rel': 0, // 關閉相關影片
                    'showinfo': 0, 
                    'iv_load_policy': 3 // 關鍵：不載入影片註解/資訊卡，減少跳轉時的閃爍
                },
                events: {
                    'onReady': (event) => onPlayerReady(event, isEditor),
                    'onStateChange': (event) => onPlayerStateChange(event, isEditor)
                }
            });
        }

        /** 播放器準備好時 */
        function onPlayerReady(event, isEditor) {
            if (isEditor) {
                // 編輯模式的播放器
                player = event.target;
                document.getElementById('load-video-btn').disabled = false;
                document.getElementById('youtube-url').disabled = true;

                // 顯示載入成功訊息
                displayMessage(`影片已載入 (ID: ${videoId})。請在下方編輯剪輯點。`, 'success');

            } else {
                // 分享模式的播放器
                sharePlayer = event.target;
                // 分享模式載入後立即開始播放序列
                if (isShareMode && segments.length > 0) {
                    playFullSplicedVideo(true); // true 表示使用 sharePlayer
                }
            }
        }

        /** 播放狀態改變時 */
        function onPlayerStateChange(event, isEditor) {
            const activePlayer = isEditor ? player : sharePlayer;

            if (event.data === YT.PlayerState.PLAYING) {
                // 處理編輯模式 (需要更新時間顯示)
                if (isEditor) {
                    if (!intervalId) {
                        const currentTimeDisplay = document.getElementById('current-time');
                        intervalId = setInterval(() => {
                            currentTimeDisplay.innerText = secondsToTime(activePlayer.getCurrentTime());
                            if (isPlayingSequence) {
                                checkSegmentEnd(activePlayer);
                            }
                        }, 100);
                    }
                // 處理分享模式 (不需要更新時間顯示，但需要檢查片段結束)
                } else {
                     // 為 sharePlayer 設置專屬的計時器來檢查片段結束
                     if (!shareIntervalId) {
                        shareIntervalId = setInterval(() => {
                            if (isPlayingSequence) {
                                checkSegmentEnd(activePlayer);
                            }
                        }, 100);
                    }
                }
            } else {
                // 非播放狀態時清除計時器
                if (isEditor) {
                    if (intervalId) {
                        clearInterval(intervalId);
                        intervalId = null;
                    }
                } else {
                    if (shareIntervalId) {
                        clearInterval(shareIntervalId);
                        shareIntervalId = null;
                    }
                }
                
                // 無論哪種模式，影片結束時都停止序列播放
                if (event.data === YT.PlayerState.ENDED) {
                    if (isPlayingSequence) {
                        stopSequencePlayback(activePlayer);
                    }
                }
            }
        }

        /** 檢查當前片段是否結束，並跳轉或停止 */
        function checkSegmentEnd(activePlayer) {
            if (!isPlayingSequence || segments.length === 0) return;

            const segment = segments[currentSegmentIndex];
            const currentTime = activePlayer.getCurrentTime();

            // 如果當前時間大於片段的結束時間，則切換到下一個片段
            if (currentTime > segment.end) {
                activePlayer.pauseVideo();
                currentSegmentIndex++;

                if (currentSegmentIndex < segments.length) {
                    // 播放下一個片段
                    const nextSegment = segments[currentSegmentIndex];
                    activePlayer.seekTo(nextSegment.start, true);
                    activePlayer.playVideo();
                } else {
                    // 序列播放完成
                    stopSequencePlayback(activePlayer);
                    displayMessage('🎉 精華片段播放完畢！', 'success');
                }
            }
        }

        /** 停止序列播放 */
        function stopSequencePlayback(activePlayer) {
            isPlayingSequence = false;
            currentSegmentIndex = 0;

            // 統一清除所有可能的計時器
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            if (shareIntervalId) {
                clearInterval(shareIntervalId);
                shareIntervalId = null;
            }
            
            // 使用 pauseVideo() 代替 stopVideo()
            activePlayer.pauseVideo(); 
            
            // 在編輯模式下，重新啟用按鈕
            if (activePlayer === player) {
                document.getElementById('play-full-spliced-btn').disabled = false;
                document.getElementById('play-full-spliced-btn').textContent = `預覽完整剪接影片 (${segments.length} 片段)`;
            }
        }

        // --- 步驟 2: 片段編輯 ---

        /** 動態新增一個片段輸入區 */
        function addSegment() {
            const newIndex = segments.length;
            // 預設一個空片段
            segments.push({ start: 0, end: 0, startInput: '', endInput: '' });
            renderSegmentsList();
        }

        /** 移除指定索引的片段 */
        function removeSegment(index) {
            segments.splice(index, 1);
            renderSegmentsList();
            updateShareLink();
        }

        /** 擷取當前播放器的時間到指定輸入欄位 */
        function captureTime(index, type) {
            if (!player || player.getPlayerState() === -1) {
                displayMessage('請先載入影片！', 'warning');
                return;
            }

            const currentTime = player.getCurrentTime();
            const timeStr = secondsToTime(currentTime);

            // 更新 segments 陣列和 input 欄位
            if (type === 'start') {
                segments[index].start = currentTime;
                segments[index].startInput = timeStr;
                document.getElementById(`start-input-${index}`).value = timeStr;
            } else if (type === 'end') {
                segments[index].end = currentTime;
                segments[index].endInput = timeStr;
                document.getElementById(`end-input-${index}`).value = timeStr;
            }

            // 更新分享連結
            updateShareLink();
            // 重新渲染以更新預覽按鈕狀態
            renderSegmentsList();
        }

        /** 從輸入欄位更新 segments 陣列 */
        function updateSegmentFromInput(index, type, value) {
            const seconds = timeToSeconds(value);

            if (type === 'start') {
                segments[index].start = seconds;
                segments[index].startInput = value;
            } else if (type === 'end') {
                segments[index].end = seconds;
                segments[index].endInput = value;
            }

            // 更新分享連結
            updateShareLink();
            // 重新渲染以更新預覽按鈕狀態
            renderSegmentsList();
        }

        /** 渲染片段列表的 HTML 結構 */
        function renderSegmentsList() {
            const list = document.getElementById('segments-list');
            list.innerHTML = ''; // 清空現有列表

            segments.forEach((segment, index) => {
                const isComplete = segment.start >= 0 && segment.end > segment.start;
                const segmentElement = document.createElement('div');
                segmentElement.className = `p-4 border rounded-lg shadow-sm space-y-3 transition duration-200 ${isComplete ? 'border-green-300 bg-green-50' : 'border-gray-300 bg-white'}`;
                segmentElement.innerHTML = `
                    <div class="flex justify-between items-center pb-2 border-b">
                        <h4 class="text-base font-semibold text-gray-700">片段 #${index + 1}</h4>
                        <button onclick="removeSegment(${index})" class="text-red-500 hover:text-red-700 transition duration-150">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- 開始時間 -->
                        <div class="flex items-center space-x-2">
                            <input type="text" id="start-input-${index}" placeholder="開始 (MM:SS)" value="${segment.startInput}"
                                onchange="updateSegmentFromInput(${index}, 'start', this.value)"
                                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <button onclick="captureTime(${index}, 'start')"
                                    class="flex-shrink-0 px-3 py-2 text-xs bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-150 whitespace-nowrap">
                                擷取當前時間
                            </button>
                        </div>
                        <!-- 結束時間 -->
                        <div class="flex items-center space-x-2">
                            <input type="text" id="end-input-${index}" placeholder="結束 (MM:SS)" value="${segment.endInput}"
                                onchange="updateSegmentFromInput(${index}, 'end', this.value)"
                                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <button onclick="captureTime(${index}, 'end')"
                                    class="flex-shrink-0 px-3 py-2 text-xs bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-150 whitespace-nowrap">
                                擷取當前時間
                            </button>
                        </div>
                    </div>

                    <!-- 預覽按鈕 -->
                    <button onclick="previewSegment(${index})" ${isComplete ? '' : 'disabled'}
                            class="w-full mt-2 px-4 py-2 bg-yellow-500 text-white font-medium rounded-lg hover:bg-yellow-600 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed">
                        預覽片段 #${index + 1} (${segment.startInput} ~ ${segment.endInput})
                    </button>
                `;
                list.appendChild(segmentElement);
            });

            // 更新主要播放按鈕的狀態
            checkFullSplicedPlayability();
        }

        /** 檢查是否所有片段都有效，並更新主要播放按鈕 */
        function checkFullSplicedPlayability() {
            const allValid = segments.length > 0 && segments.every(s => s.start >= 0 && s.end > s.start);
            const button = document.getElementById('play-full-spliced-btn');
            button.disabled = !allValid;
            button.textContent = `預覽完整剪接影片 (${segments.length} 片段)`;

            const shareLinkArea = document.getElementById('share-link-area');
            if (allValid) {
                shareLinkArea.classList.remove('hidden');
            } else {
                shareLinkArea.classList.add('hidden');
            }
        }

        /** 預覽單個片段 */
        function previewSegment(index) {
            if (!player) {
                displayMessage('請先載入影片！', 'warning');
                return;
            }

            const segment = segments[index];
            if (segment.start >= segment.end) {
                displayMessage('開始時間必須早於結束時間。', 'warning');
                return;
            }

            // 1. 停止任何正在進行的播放序列，確保狀態重置
            stopSequencePlayback(player);

            // 2. 設定狀態：將當前片段設為要預覽的片段，並開啟序列播放模式
            isPlayingSequence = true;
            currentSegmentIndex = index;

            // 3. 延遲 50 毫秒後執行 Seek 和 Play
            setTimeout(() => {
                player.seekTo(segment.start, true);
                player.playVideo();
            }, 50);


            displayMessage(`正在預覽片段 #${index + 1} (${segment.startInput} ~ ${segment.endInput})`, 'info');
        }

        /** 播放完整剪接影片序列 */
        function playFullSplicedVideo(useSharePlayer = false) {
            const activePlayer = useSharePlayer ? sharePlayer : player;
            if (!activePlayer) {
                displayMessage('播放器未準備好。', 'warning');
                return;
            }

            if (segments.length === 0 || !segments.every(s => s.start >= 0 && s.end > s.start)) {
                displayMessage('請先設定有效的剪輯片段。', 'error');
                return;
            }

            if (!useSharePlayer) {
                // 編輯模式下，禁用按鈕並顯示狀態
                document.getElementById('play-full-spliced-btn').disabled = true;
                document.getElementById('play-full-spliced-btn').textContent = '▶️ 正在播放...';
            }

            // 初始化序列播放狀態
            isPlayingSequence = true;
            currentSegmentIndex = 0;

            const firstSegment = segments[0];
            activePlayer.seekTo(firstSegment.start, true);
            activePlayer.playVideo();

            displayMessage(`開始播放完整剪接序列 (共 ${segments.length} 個片段)...`, 'info');
        }


        // --- 分享/URL 處理 ---

        /** 產生分享連結並更新輸入框 */
        function updateShareLink() {
            if (!videoId || segments.length === 0 || !segments.every(s => s.start >= 0 && s.end > s.start)) {
                document.getElementById('share-link').value = '請完成所有有效的剪輯片段以生成分享連結';
                return;
            }

            // 簡化 segments 數據為 S-E,S-E,... 格式
            const data = segments
                .filter(s => s.start < s.end) // 確保只包含有效片段
                .map(s => `${Math.floor(s.start)}-${Math.ceil(s.end)}`) // 使用整數秒數
                .join(',');

            const shareUrl = `${window.location.origin}${window.location.pathname}?v=${videoId}&segments=${encodeURIComponent(data)}`;
            document.getElementById('share-link').value = shareUrl;
        }

        /** 複製分享連結 */
        function copyShareLink() {
            const linkInput = document.getElementById('share-link');
            try {
                // 較舊的 execCommand 仍然是 iFrame 內最可靠的方法
                linkInput.select();
                document.execCommand('copy');
                displayMessage('分享連結已複製到剪貼簿！', 'success');
            } catch (err) {
                displayMessage('複製失敗，請手動複製連結。', 'error');
            }
        }

        /** 從 URL 參數解析影片 ID 和片段數據 */
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const vParam = params.get('v');
            const segmentsParam = params.get('segments');

            if (vParam && segmentsParam) {
                isShareMode = true;
                videoId = vParam;

                // 解析片段數據
                const parsedSegments = segmentsParam.split(',')
                    .map(pair => {
                        const [start, end] = pair.split('-').map(Number);
                        if (end > start) {
                            return {
                                start: start,
                                end: end,
                                startInput: secondsToTime(start),
                                endInput: secondsToTime(end)
                            };
                        }
                        return null;
                    })
                    .filter(s => s !== null);

                if (parsedSegments.length > 0) {
                    segments = parsedSegments;
                    switchToShareView();
                } else {
                    // 數據無效，切換回編輯模式
                    isShareMode = false;
                    displayMessage('URL中的剪輯數據無效，已切換回編輯模式。', 'warning');
                }
            }
        }

        /** 切換到分享模式介面 */
        function switchToShareView() {
            document.getElementById('editor-view').classList.add('hidden');
            document.getElementById('share-view').classList.remove('hidden');

            document.getElementById('share-info').innerHTML = `影片 ID: <span class="font-bold text-gray-800">${videoId}</span>，共 <span class="font-bold text-gray-800">${segments.length}</span> 個片段。`;

            // 初始化分享播放器
            initYouTubePlayer('share-player', videoId, false);
            displayMessage('進入分享模式，播放器將自動載入並開始播放。', 'info');
        }

        // --- 初始化應用程式 ---

        window.onload = function () {
            checkUrlParams();
            // 如果不是分享模式，則手動觸發一次渲染，確保編輯介面正確
            if (!isShareMode) {
                 // 載入時預設載入一個片段，方便使用者開始
                addSegment();
            }
        };

        // 監聽 YouTube Player API 載入完成
        function onYouTubeIframeAPIReady() {
            // 如果不是分享模式，預載入一個範例 ID，方便測試
            if (!isShareMode) {
                const exampleId = '2n7r6jN_q3M'; 
                document.getElementById('youtube-url').value = `https://www.youtube.com/watch?v=${exampleId}`;
            }
        }

    </script>
</body>
</html>
